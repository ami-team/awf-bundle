var e=(e,s,a)=>new Promise(((l,o)=>{var t=e=>{try{r(a.next(e))}catch(s){o(s)}},n=e=>{try{r(a.throw(e))}catch(s){o(s)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(t,n);r((a=a.apply(e,s)).next())}));import{A as s,i as a,r as l,b as o,B as t,w as n,d as r,v as i,c,F as d,g as m,t as u,C as p,x as b,D as k,j as y,u as h,k as f,s as v,a as _,p as g,E as C,q as A,e as S,G as w,H as D,I as E,y as B,z as L,m as F,o as T,h as x}from"./app.min.js";import{_ as N,t as O,a as $,b as j}from"./z7616e8e1.min.js";import{F as q}from"./z623c1136.min.js";const U=s("table",{state:()=>({columns:{id:"ID",name:"Name",serverName:"Server name",running:"Status",success:"Success",timeStep:"Time step",lastStartDate:"Last start date",lastStopDate:"Last stop date"}}),actions:{setColumn(e,s){s?this.columns[e]=e.charAt(0).toUpperCase()+e.slice(1):delete this.columns[e]}}}),V={key:0},z=[r("i",{class:"bi bi-files"},null,-1)],I={key:1},P=r("i",{class:"bi bi-plus"},null,-1),R={class:"mb-2"},H=r("label",{class:"form-label",for:"F82EE1A7_67B1_5DDE_9733_53E83B06ED5E"},"Server name",-1),M=r("option",{value:"",selected:"",disabled:"",hidden:""},"Server name",-1),G={class:"mb-2"},J=r("label",{class:"form-label",for:"AA532AE4_9AAE_E651_4218_778B766C0F76"},"Task name",-1),K={class:"mb-2"},Q=r("label",{class:"form-label",for:"FA3A1D29_DCA2_7960_E0FC_FA60B3114452"},"Description",-1),W={class:"mb-2"},X=r("label",{class:"form-label",for:"C4419C6C_0659_49CB_A8AE_FC149BB3F6EE"},"Command line",-1),Y={class:"row"},Z={class:"col-md-6"},ee={class:"mb-2"},se=r("label",{class:"form-label",for:"C8004ABB_5181_4B50_B8E1_E217568A4087"},"Priority [> 0]",-1),ae={class:"col-md-6"},le={class:"mb-2"},oe=r("label",{class:"form-label",for:"C3C92887_249D_1F56_FF87_540667324A8D"},"Time step [s]",-1),te={class:"mb-0"},ne={class:"form-check form-switch form-switch-lg"},re={class:"form-check-label ms-1 my-2",for:"E7613D9D_801C_5DED_DCA3_D9C0ED2CA9AA"},ie={__name:"TaskModal",props:{duplicate:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!0},name:{type:String},command:{type:String},description:{type:String},priority:{type:String},timeStep:{type:String},isOneShot:{type:Boolean}},setup(e){const s=e,f=a("toast"),v=a("mqttClient"),_=l({taskName:s.name||"",commandLine:s.command||"",description:s.description||"",priority:s.priority||0,timeStep:s.timeStep||10,serverName:"",isLocked:!1,isOneShot:s.isOneShot||!1,serverNames:[]}),g=()=>{v.execute("ListTaskServers").then((e=>{_.serverNames=v.jspath('..field{.@name==="name"}.$',e.data)})).catch((e=>{f("error",e.message)}))},C=()=>{v.execute('AddTask -name=? -locked="1" -oneShot=? -command=? -description=? -priority=? -timeStep=? -serverName=?',{params:[_.taskName,_.isOneShot?1:0,_.commandLine,_.description,_.priority,_.timeStep,_.serverName]}).then((()=>{f("success","Successfully created new task")})).catch((e=>{f("error",e.message)}))};return(e,a)=>(o(),t(h(N),{class:"me-3","modal-size":"lg","modal-icon":s.duplicate?"files":"plus-circle","modal-title":s.duplicate?"Duplicate task":"New task",link:s.duplicate,"button-disabled":s.isLoading,onClick:g,onConfirm:C},{textDescription:n((()=>[r("form",null,[r("div",R,[H,i(r("select",{class:"form-select form-select-sm","onUpdate:modelValue":a[0]||(a[0]=e=>_.serverName=e),id:"F82EE1A7_67B1_5DDE_9733_53E83B06ED5E"},[M,(o(!0),c(d,null,m(_.serverNames,(e=>(o(),c("option",{key:e},u(e),1)))),128))],512),[[p,_.serverName]])]),r("div",G,[J,i(r("input",{class:"form-control form-control-sm",type:"text",placeholder:"Task name","onUpdate:modelValue":a[1]||(a[1]=e=>_.taskName=e),id:"AA532AE4_9AAE_E651_4218_778B766C0F76"},null,512),[[b,_.taskName]])]),r("div",K,[Q,i(r("input",{class:"form-control form-control-sm",type:"text",placeholder:"Description","onUpdate:modelValue":a[2]||(a[2]=e=>_.description=e),id:"FA3A1D29_DCA2_7960_E0FC_FA60B3114452"},null,512),[[b,_.description]])]),r("div",W,[X,i(r("textarea",{class:"form-control form-control-sm",rows:"5",placeholder:"echo 'hello world'","onUpdate:modelValue":a[3]||(a[3]=e=>_.commandLine=e),id:"C4419C6C_0659_49CB_A8AE_FC149BB3F6EE"},null,512),[[b,_.commandLine]])]),r("div",Y,[r("div",Z,[r("div",ee,[se,i(r("input",{class:"form-control form-control-sm",type:"number",min:"0",placeholder:"Priority","onUpdate:modelValue":a[4]||(a[4]=e=>_.priority=e),id:"C8004ABB_5181_4B50_B8E1_E217568A4087"},null,512),[[b,_.priority]])])]),r("div",ae,[r("div",le,[oe,i(r("input",{class:"form-control form-control-sm",type:"number",min:"0",placeholder:"Time step","onUpdate:modelValue":a[5]||(a[5]=e=>_.timeStep=e),id:"C3C92887_249D_1F56_FF87_540667324A8D"},null,512),[[b,_.timeStep]])])])]),r("div",te,[r("div",ne,[i(r("input",{class:"form-check-input",type:"checkbox",role:"switch","onUpdate:modelValue":a[6]||(a[6]=e=>_.isOneShot=e),id:"E7613D9D_801C_5DED_DCA3_D9C0ED2CA9AA"},null,512),[[k,_.isOneShot]]),r("label",re,u(_.isOneShot?"Task is one-shot":"Task is recurrent"),1)])])])])),default:n((()=>[s.duplicate?(o(),c("span",V,z)):(o(),c("span",I,[P,y(" New task ")]))])),_:1},8,["modal-icon","modal-title","link","button-disabled"]))}},ce=e=>(B("data-v-9d7d2d85"),e=e(),L(),e),de={class:"table table-hover"},me={key:0},ue={key:0},pe=ce((()=>r("th",null,null,-1))),be=["onClick"],ke=ce((()=>r("i",{class:"ps-2 bi bi-arrow-down-up"},null,-1))),ye={key:1},he={key:0},fe=ce((()=>r("th",null,null,-1))),ve=["onClick"],_e=ce((()=>r("i",{class:"ps-2 bi bi-arrow-down-up"},null,-1))),ge={key:0},Ce={key:0,class:"py-3"},Ae=["href"],Se=[ce((()=>r("i",{class:"bi bi-three-dots"},null,-1)))],we={key:1},De={key:0},Ee=["href"],Be=[ce((()=>r("i",{class:"bi bi-three-dots"},null,-1)))],Le=["id"],Fe=["colspan"],Te={class:"mb-2"},xe=ce((()=>r("label",{class:"form-label"},"Description",-1))),Ne=["value"],Oe={class:"mb-2"},$e=ce((()=>r("label",{class:"form-label"},"Command:",-1))),je=["value"],qe={class:"mb-2"},Ue=ce((()=>r("label",{class:"form-label"},"Report:",-1))),Ve=["value"],ze={class:"mb-0"},Ie=["innerHTML"],Pe={key:1},Re=f({__name:"CustomTable",props:{columns:{type:[Array,Object],default:()=>[]},rows:{type:Array,default:()=>[]},isLoading:{type:Boolean,default:!0},isFoldable:{type:Boolean,default:!1}},setup(s){const a=s,l=v(),t=_("id"),n=_(!0),i=_(l.query.search||""),p=g((()=>l.query.search));C(p,(s=>e(this,null,(function*(){i.value=s}))));const b=e=>{t.value===e&&(n.value=!n.value),t.value=e},k=g((()=>a.rows.filter((e=>e.name.toLowerCase().includes(i.value.toLowerCase()))).sort(((e,s)=>{let a=1;return n.value||(a=-1),e[t.value].localeCompare(s[t.value],void 0,{numeric:!0})*a}))));return(e,a)=>(o(),c("table",de,[r("thead",null,[Array.isArray(s.columns)?(o(),c("tr",me,[s.isFoldable?(o(),c("th",ue)):A("",!0),pe,(o(!0),c(d,null,m(s.columns,(e=>(o(),c("th",{class:"cursor-pointer",scope:"col",key:e,onClick:s=>b(e)},[y(u(e)+" ",1),ke],8,be)))),128))])):(o(),c("tr",ye,[s.isFoldable?(o(),c("th",he)):A("",!0),fe,(o(!0),c(d,null,m(s.columns,((e,s)=>(o(),c("th",{class:"cursor-pointer",scope:"col",key:s,onClick:e=>b(s)},[y(u(e)+" ",1),_e],8,ve)))),128))]))]),r("tbody",null,[(o(!0),c(d,null,m(k.value,(a=>{return o(),c(d,{key:a.id},[Array.isArray(s.columns)?(o(),c("tr",ge,[s.isFoldable?(o(),c("td",Ce,[r("a",{"data-bs-toggle":"collapse",href:`#tr-panel-${a.id}`,role:"button"},Se,8,Ae)])):A("",!0),r("td",null,[S(ie,{"is-loading":!1,duplicate:!0,name:a.name,description:a.description,command:a.command,priority:a.priority,"time-step":a.timeStep,"is-one-shot":!Boolean(a.oneShot),"server-name":a.serverName},null,8,["name","description","command","priority","time-step","is-one-shot","server-name"])]),(o(!0),c(d,null,m(s.columns,(s=>(o(),c("td",{class:"py-3",key:s.id},[w(e.$slots,s,D(E(a)),(()=>[y(u(a[s]),1)]),!0)])))),128))])):(o(),c("tr",we,[s.isFoldable?(o(),c("td",De,[r("a",{"data-bs-toggle":"collapse",href:`#tr-panel-${a.id}`,role:"button"},Be,8,Ee)])):A("",!0),r("td",null,[S(ie,{"is-loading":!1,duplicate:!0,name:a.name,description:a.description,command:a.command,priority:a.priority,"time-step":a.timeStep,"is-one-shot":!Boolean(a.oneShot),"server-name":a.serverName},null,8,["name","description","command","priority","time-step","is-one-shot","server-name"])]),(o(!0),c(d,null,m(s.columns,((s,l)=>(o(),c("td",{key:s},[w(e.$slots,l,D(E(a)),(()=>[y(u(a[l]),1)]),!0)])))),128))])),s.isFoldable?(o(),c("tr",{key:2,class:"collapse bg-light",id:`tr-panel-${a.id}`},[r("td",{class:"fw-bold",colspan:Array.isArray(s.columns)?s.columns.length+2:Object.keys(s.columns).length+2},[r("div",Te,[xe,r("input",{class:"form-control form-control-sm",value:a.description,readonly:"readonly"},null,8,Ne)]),r("div",Oe,[$e,r("textarea",{class:"form-control form-control-sm",rows:"4",value:a.command,readonly:"readonly"},null,8,je)]),r("div",qe,[Ue,r("textarea",{class:"form-control form-control-sm",rows:"4",value:a.report,readonly:"readonly"},null,8,Ve)]),r("div",ze,[y(" Locks: "),a.commaSeparatedLocks?(o(),c("span",{key:0,innerHTML:(l=a.commaSeparatedLocks,l?l.split(",").map((e=>`<span class="badge bg-success">${e.trim()}</span>`)).join(" "):"-")},null,8,Ie)):(o(),c("span",Pe,"-"))])],8,Fe)],8,Le)):A("",!0)],64);var l})),128))])]))}},[["__scopeId","data-v-9d7d2d85"]]),He={class:"dropdown"},Me=r("button",{class:"btn btn-outline-secondary dropdown-toggle",type:"button","data-bs-toggle":"dropdown","data-bs-auto-close":"outside"},[r("i",{class:"bi bi-filter"}),y(" Columns ")],-1),Ge={class:"dropdown-menu dropdown-menu-end p-3"},Je=["id","checked","onChange"],Ke=["for"],Qe={__name:"ColumnSelector",props:{keys:{type:Array,required:!0},columns:{type:[Array,Object],required:!0},isLoading:{type:Boolean,default:!0}},setup(e){const s=U();return(a,l)=>(o(),c("div",He,[Me,r("form",Ge,[(o(!0),c(d,null,m(e.keys,(a=>(o(),c("div",{class:"form-check",key:a},[r("input",{class:"form-check-input",type:"checkbox",id:`id-${a}`,checked:e.columns[a],onChange:e=>h(s).setColumn(a,e.target.checked)},null,40,Je),r("label",{class:"form-check-label",for:`id-${a}`},u(a),9,Ke)])))),128))])]))}},We={class:"d-flex mb-2"},Xe={__name:"TableControl",props:{columns:{type:Array,required:!0},isOneShot:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!0}},setup(e){const s=F(),a=U(),l=e=>{s.push({query:{search:e}})};return(s,t)=>(o(),c("div",We,[S(ie,{class:"me-1","is-one-shot":e.isOneShot,"is-loading":e.isLoading},null,8,["is-one-shot","is-loading"]),S(h(q),{class:"me-auto",placeholder:"Filter tasks...",onUpdateSearch:l}),S(Qe,{columns:h(a).columns,keys:e.columns,"is-loading":e.isLoading},null,8,["columns","keys","is-loading"])]))}},Ye={class:"container py-2"},Ze={key:0,class:"fw-bold"},es=r("i",{class:"bi bi-clock"},null,-1),ss={key:1,class:"fw-bold"},as=r("i",{class:"bi bi-bezier2"},null,-1),ls={key:2,class:"fw-bold"},os=r("i",{class:"bi bi-hdd"},null,-1),ts={class:"badge rounded-pill text-bg-dark px-2 py-1"},ns={class:"card border-0 card-shadow p-4"},rs={class:"table-responsive"},is={__name:"ListTasksView",setup(s){const t=v(),i=a("toast"),d=a("mqttClient"),m=U(),p=l({tasks:[],columns:[],isLoading:!0});return T((()=>e(this,null,(function*(){d.connect((e=>{let s;if("listRecurrentTasks"===t.name)s=e.execute("ListTasks -oneShot=?",{params:[0]});else if("listOneShotTasks"===t.name)s=e.execute("ListTasks -oneShot=?",{params:[1]});else{if("listServerTasks"!==t.name)return;s=e.execute("ListTasks -serverName=?",{params:[t.params.name]})}s.then((s=>{e.subscribe("ami/taskserver/task"),p.tasks=O(e.jspath("..row",s.data)),p.tasks.length>0&&(p.columns=Object.keys(p.tasks[0]))})).catch((e=>{i("error",e.message)})).finally((()=>{p.isLoading=!1}))}),((e,s,a)=>{if("ami/taskserver/task"===s){const e=JSON.parse(a),s=p.tasks.findIndex((s=>s.id===e.task_id.toString()));s>=0&&(p.tasks[s].running=e.state_code.toString(),p.tasks[s].success=e.success?"1":"0")}}),null).catch((e=>{i("error",e)}))})))),(e,s)=>{const a=x("router-link");return o(),c("div",Ye,["listRecurrentTasks"===e.$route.name?(o(),c("h1",Ze,[es,y(" Recurrent tasks ")])):"listOneShotTasks"===e.$route.name?(o(),c("h1",ss,[as,y(" One shot tasks ")])):"listServerTasks"===e.$route.name?(o(),c("h1",ls,[os,y(" Tasks for "),r("span",ts,u(h(t).params.name),1)])):A("",!0),r("div",ns,[S(Xe,{columns:p.columns,"is-one-shot":"listOneShotTasks"===e.$route.name,"is-loading":p.isLoading},null,8,["columns","is-one-shot","is-loading"]),r("div",rs,[S(Re,{columns:h(m).columns,rows:p.tasks,"is-loading":p.isLoading,"is-foldable":"",debug:""},{name:n((({id:e,name:s})=>[S(a,{class:"fw-bold text-decoration-none text-black",to:`/task/${e}`},{default:n((()=>[y(u(s),1)])),_:2},1032,["to"])])),serverName:n((({serverName:e})=>[S(a,{class:"fw-bold text-decoration-none text-black",to:`/server/${e}`},{default:n((()=>[y(u(e),1)])),_:2},1032,["to"])])),running:n((({locked:e,running:s})=>[S($,{"is-loading":p.isLoading,locked:e,running:s,label:!0},null,8,["is-loading","locked","running"])])),success:n((({running:e,success:s})=>[S(j,{"is-loading":p.isLoading,running:e,success:s,label:!0},null,8,["is-loading","running","success"])])),timeStep:n((({timeStep:e,priority:s})=>[y(u(e)+"/"+u(s),1)])),_:1},8,["columns","rows","is-loading"])])])])}}};export{is as default};
